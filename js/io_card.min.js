
$(function(){$(document).on("click",".panel-body .card",function(){$("#card_title_text").val($(this).html());$("#card-edit").attr("data-id",$(this).attr("cardId"));$("#card-edit").attr("card_panel_id",$(this).parent().parent().find(".panel-heading h2").attr("data-id"));$("#card_label_color").val($(this).attr("label_color"));$("#card-move-modal").attr("data-id",$(this).attr("cardId"));if($(this).attr("cardId")==="new"){$("#card_title_text").val("");$("#contents").val("");$("#contents_view").html("");$("#card_label_color").val("#cccccc");$("#card_label_color").spectrum({showSelectionPalette:true,preferredFormat:"hex",showInput:true,showInitial:true,showPaletteOnly:true,palette:[["#ffffff","#cccccc","#999999","#666666","#333333","#000000"],["#f44336","#ff9800","#ffeb3b","#8bc34a","#4caf50","#03a9f4","#2196f3"]]})}else{exePost("cards","find",$(this).attr("cardId"),"","","","").done(function(b){if(b){var a=$.parseJSON(b);$("#contents").val(a.contents);$("#contents_view").html(nl2br(a.contents)).linkify({target:"_blank"});$("#card_label_color").val(a.label_color);$("#card_label_color").spectrum({showSelectionPalette:true,preferredFormat:"hex",showInput:true,showInitial:true,showPaletteOnly:true,palette:[["#ffffff","#cccccc","#999999","#666666","#333333","#000000"],["#f44336","#ff9800","#ffeb3b","#8bc34a","#4caf50","#03a9f4","#2196f3"]]})}}).fail(function(a){alert("system Error")});$("#contents").css("display","none");$("#contents_view").css("display","block")}$("#card-edit").modal("show")});$(document).on("click","#contents_toggle",function(){$("#contents_view").toggle();$("#contents").toggle();if($("#contents_toggle").html()==="編集"){$("#contents_toggle").html("表示")}else{$("#contents_toggle").html("編集")}});$(document).on("click",".pannel .panel-footer .card_add",function(){$(this).parent().parent().children(".panel .panel-body").append($('<div class="card panel panel-default" label_color="" cardid="new">New</div>'))});$(document).on("click","#card-edit .modal-dialog .modal-footer button#save-btn",function(){var f=$("#card_title_text").val();var d=$("#card_label_color").val();var c=$("#contents").val();var a=$("#card-edit").attr("data-id");var e=$("#board_title").attr("data-id");var b=$("#card-edit").attr("card_panel_id");if((typeof a==="undefined")||(a==="")){a="new"}exePost("cards","save",a,f,b,d,c).done(function(h){var g=$.parseJSON(h);var i=g.label_color;if(i==null){i=""}if($("#panel_area .panel h2[data-id='"+b+"']").parent().parent().find(".panel-body .card[cardId='new']").length>0){$("#panel_area .panel h2[data-id='"+b+"']").parent().parent().find(".panel-body .card[cardId='new']:last-child").html(g.title);$("#panel_area .panel h2[data-id='"+b+"']").parent().parent().find(".panel-body .card[cardId='new']:last-child").attr("style","border-top: 12px solid "+i);$("#panel_area .panel h2[data-id='"+b+"']").parent().parent().find(".panel-body .card[cardId='new']:last-child").attr("cardID",g.id)}else{$(".card[cardId='"+g.id+"']").html(g.title);$(".card[cardId='"+g.id+"']").attr("style","border-top: 12px solid "+i)}$("#card_title_text").val("");$("#card_label_color").val("");$("#contents").val("");$("#card-edit").modal("hide")}).fail(function(g){alert("system Error")})});$(document).on("click","#card-edit .modal-dialog .modal-footer button#delete-btn",function(){if(window.confirm("このカードを削除します。よろしいですか？")){var a=$("#card-edit").attr("data-id");var b=$("#card-edit").attr("card_panel_id");exePost("cards","del",a,"","","","").done(function(){$("#panel_area .panel h2[data-id='"+b+"']").parent().parent().find(".panel-body .card[cardId='"+a+"']").remove();$("#card-edit").modal("hide")}).fail(function(){alert("system Error")})}});$(document).on("click","#card-edit .modal-dialog .modal-footer button#move-btn",function(){$("#card-move-modal").modal("show");$("#board_select").html("");$("#panel_select").html("");exePost("boards","list","","","").done(function(b){var c=$.parseJSON(b);var a="<option value=''>-</option>";$.each(c,function(d,e){a+="<option value='"+e.id+"'>"+e.title+"</option>"});$("#board_select").append(a)}).fail(function(a){alert("system Error")});$(document).on("change","#board_select",function(){exePost("panels","list",$(this).val(),"","").done(function(b){if(b!==false){var c=$.parseJSON(b);var a="";$.each(c,function(d,e){a+="<option value='"+e.id+"'>"+e.title+"</option>"})}$("#panel_select").html("");$("#panel_select").append(a)}).fail(function(a){alert("system Error")})});$(document).on("click","#card-move-modal .modal-dialog .modal-footer button#save-panel-btn",function(){var a=$("#board_select").val();var d=$("#panel_select").val();var c=$("#card-move-modal").attr("data-id");var b=$("input[name='q']:radio:checked").val();exePost("cards",b,c,d,"","","").done(function(){$("#panel_area").html("");exePost("boards","first","","","").done(function(f){if(f){var e=$.parseJSON(f);$("#board_title h1").html(e.title);$("#board_title").attr("data-id",e.id);$("body").css("background-color",e.board_color);$("input#board_title_text").val(e.title);$("input#board_color").val(e.board_color);$("input#board_color").spectrum({showSelectionPalette:true,preferredFormat:"hex",showInput:true,showInitial:true,showPaletteOnly:true,palette:[["#ffffff","#cccccc","#999999","#666666","#333333","#000000"],["#f44336","#ff9800","#ffeb3b","#8bc34a","#4caf50","#03a9f4","#2196f3"]]});getPanels(e.id);$("#card-move-modal").modal("hide")}}).fail(function(e){alert("system Error")})}).fail(function(){alert("system Error")})})})});